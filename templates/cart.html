{% extends "base.html" %}
{% block title %}Your Cart{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-6">

  <h1 class="text-2xl font-bold mb-6 text-black">Shopping Cart</h1>

  {% if items and items|length > 0 %}

  <!-- ================= DESKTOP VIEW ================= -->
  <div class="hidden md:block overflow-x-auto">
    <table class="w-full border-collapse bg-white rounded-xl shadow">
      <thead class="bg-gray-100 text-black">
        <tr>
          <th class="p-3 text-left">Product</th>
          <th class="p-3 text-left">Name</th>
          <th class="p-3">Price</th>
          <th class="p-3">Qty</th>
          <th class="p-3">Total</th>
          <th class="p-3">Action</th>
        </tr>
      </thead>

      <tbody>
        {% for item in items %}
        <tr class="border-t text-black">
          <td class="p-3">
            <img
              src="{{ item.image if item.image.startswith('/static/') else '/static/uploads/' ~ item.image }}"
              class="w-20 h-20 object-cover rounded"
            >
          </td>

          <td class="p-3 max-w-xs">
            <p class="font-medium line-clamp-2">{{ item.name }}</p>
          </td>

          <td class="p-3 text-center">₹{{ item.price }}</td>

          <td class="p-3 text-center">
            <div class="inline-flex items-center gap-2">
              <a href="/cart/update/{{ item.product_id }}/decrease"
                 class="px-2 py-1 bg-gray-200 rounded">−</a>
              <span>{{ item.qty }}</span>
              <a href="/cart/update/{{ item.product_id }}/increase"
                 class="px-2 py-1 bg-gray-200 rounded">+</a>
            </div>
          </td>

          <td class="p-3 text-center font-semibold">
            ₹{{ item.item_total }}
          </td>

          <td class="p-3 text-center">
            <a href="/cart/remove/{{ item.product_id }}"
               class="text-red-600 hover:underline">
              Remove
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ================= MOBILE VIEW ================= -->
  <div class="md:hidden space-y-4">

    {% for item in items %}
    <div class="bg-white rounded-xl shadow p-4 flex gap-4">

      <!-- IMAGE -->
      <img
        src="{{ item.image if item.image.startswith('/static/') else '/static/uploads/' ~ item.image }}"
        class="w-20 h-20 object-cover rounded"
      >

      <!-- INFO -->
      <div class="flex-1">

        <p class="font-semibold text-black text-sm mb-1 line-clamp-2">
          {{ item.name }}
        </p>

        <p class="text-sm text-gray-700 mb-1">
          Price: ₹{{ item.price }}
        </p>

        <!-- QTY -->
        <div class="flex items-center gap-3 mb-2">
          <a href="/cart/update/{{ item.product_id }}/decrease"
             class="w-7 h-7 flex items-center justify-center bg-gray-200 rounded text-black">−</a>

          <span class="font-semibold text-black">{{ item.qty }}</span>

          <a href="/cart/update/{{ item.product_id }}/increase"
             class="w-7 h-7 flex items-center justify-center bg-gray-200 rounded text-black">+</a>
        </div>

        <!-- TOTAL + REMOVE -->
        <div class="flex justify-between items-center">
          <span class="font-bold text-black">
            ₹{{ item.item_total }}
          </span>

          <a href="/cart/remove/{{ item.product_id }}"
             class="text-red-600 text-sm">
            Remove
          </a>
        </div>

      </div>
    </div>
    {% endfor %}

  </div>

  <!-- ================= CART TOTAL ================= -->
  <div class="mt-6 flex justify-end">
    <div class="bg-white rounded-xl shadow p-4 w-full md:w-1/3">
      <div class="flex justify-between text-lg font-bold text-black">
        <span>Total</span>
        <span>₹{{ items | sum(attribute="item_total") }}</span>
      </div>

      <a href="/checkout"
         class="block mt-4 text-center bg-green-600 hover:bg-green-700
                text-white py-2 rounded font-semibold">
        Proceed to Checkout
      </a>
    </div>
  </div>

  {% else %}
    <p class="text-gray-500">Your cart is empty.</p>
  {% endif %}

</div>
{% endblock %}
